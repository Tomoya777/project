{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>芝浦課題管理システム</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">

	<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.18.1/build/cssreset/cssreset-min.css">
	<link rel="stylesheet" href="{% static 'css/style.css' %}">
	<link rel="stylesheet" href="{% static 'css/home.css' %}">
	<link rel="stylesheet" href="{% static 'css/login.css' %}">
    <script type="text/javascript" src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'js/jquery.bpopup.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}">  

</head>
<body>
    <div class="nav">
        <div class="container">
            <div class="container2">
                <a href="{% url 'home' %}">芝浦課題管理システム</a>
            </div>
            <ul id="main-menu">
                <li><a href="{% url 'home' %}">トップページ</a></li>
                <li><a href="{% url 'kadai' %}">課題一覧</a></li>
                <li>
                {% if user.is_authenticated %}
                    <p>ユーザ名：{{ user.username }}さん</p>
                    <p><a href="{% url 'logout' %}">ログアウト</a></p>
                {% else %}
                    <br>
                    <p><a href="{% url 'login' %}">ログイン</a></p>
                {% endif %}
                </li>
            </ul>
        </div>
    </div>
    <br><br><br><br><br><br>

    <div class="home">
        <div class="form">
            {% if user.is_authenticated%}
            <p>Scomb以外で出された課題を入力して下さい。</p>
            <form method="POST" id="kadaichangePost" action="ajax">
                {% csrf_token %}
                <p>科目名　：<input name="subject" id="subject_name" value="{{subject_name}}"required></p>
                <br>
                <p>課題名　：<input name="task_name" id="task_name" value="{{task_name}}" required></p>
                <br>
                <p>期日　　：<input type="date" name="deadline" id="deadline_date" value="{{submit_time_date}}" required><input type="time" name="deadline" id="deadline_time" value="{{submit_time_time}}"required></p>
                <br>
                <p>進捗度　：<input name="progress" id="progress" value="{{progress}}"required></p>
                <br>
                <p>推定時間：<input name="estimated_time" id="estimated_time" value="{{estimated_time}}" required ></p>
                <br>
                <p>備考&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    ：<input name="remarks" id="remarks" value="{{remraks}}" required ></p>
                <br>
                    <label>
                        <input type="checkbox" name="is_submit" value="1" id="is_submit">提出済み
                    </label>
                <div class="submit">
                    <p><input type="submit" value=" 課題を変更する "></p>
                </div>
            </form>
        </div>
        <br>
        <p><a href="{% url 'home' %}">トップページへ戻る</a></p>
        {% else %}
            <p>このサイトへのセッションが切れているか、ログインが完了していません。<br>
                お手数ですが、<a href="{% url 'login' %}"><b>こちら</b></a>からログインを行ってください。
            </p>
        {% endif %}
    </div>
</body>
    <script>
        $('#kadaichangePost').submit(function() {  //ボタンクリックを起点にしてajax
            event.preventDefault();
            $.ajax({
                url:$('form#kadaichangePost').attr('action'),
                type: 'POST',
                data:{
                    'task_id':"{{task_id}}",
                    'submit_time':$('#deadline_date').val() + "T" + $('#deadline_time').val(),
                    'user_id':'{{ user.username }}',
                    'subject_name':$('#subject_name').val(),
                    'task_name':$('#task_name').val(),
                    'is_submit':$('#is_submit').prop("checked"),
                    'can_submit':true,
                    'submit_url':"{{submit_url}}",
                    'estimated_time':$('#estimated_time').val(),
                    'progress':$('#progress').val(),
                    'remarks':$('#remarks').val(),
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                dataType: 'text',
                success: function(response){  // 通信成功
                    if (response == 'ok'){
                        alert('ok!')
                    }else{
                        alert(response)
                    }
                    //test
                },
            });
            return false;
        });
    </script>
</html>